<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Therapy AI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f8f9fa, #dde3e8);
            font-family: 'Poppins', sans-serif;
        }
        .container {
            max-width: 700px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
            background: #ffffff;
        }
        #chat-box {
            height: 350px;
            overflow-y: auto;
            border-radius: 10px;
            padding: 15px;
            background: #fdfdfd;
            border: 1px solid #dee2e6;
        }
        .btn-primary, .btn-success {
            border-radius: 12px;
            font-weight: 600;
        }
        .btn-secondary {
            border-radius: 50%;
            width: 40px;
            height: 40px;
        }
        .input-group input {
            border-radius: 12px;
        }
        #user-image-container img, #generated-image-container img {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center text-primary fw-bold">Art Therapy AI</h1>

        <div class="card p-4 my-4">
            <h4 class="text-center">Chat with AI</h4>
            <div id="chat-box" class="mb-3"></div>
            <div class="input-group">
                <input type="text" id="chat-input" class="form-control" placeholder="Type a message...">
                <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                <button class="btn btn-secondary" onclick="startSpeechRecognition()">ðŸŽ¤</button>
            </div>
        </div>

        <div class="card p-4 my-4">
            <h4 class="text-center">Upload and Generate Art</h4>
            <input type="file" id="image-upload" class="form-control mb-3" accept="image/*">
            <button class="btn btn-success w-100" onclick="uploadImage()">Upload & Generate</button>
            <div class="mt-3 text-center" id="user-image-container"></div>
            <div class="mt-3 text-center" id="generated-image-container"></div>
        </div>
    </div>

    <script>
        function sendMessage() {
            let input = document.getElementById("chat-input").value;
            if (!input) return;

            $("#chat-box").append(`<div><strong>You:</strong> ${input}</div>`);
            $("#chat-input").val("");

            $.ajax({
                type: "POST",
                url: "/chat",
                contentType: "application/json",
                data: JSON.stringify({ message: input }),
                success: function(response) {
                    $("#chat-box").append(`<div class='text-primary'><strong>AI:</strong> ${response.response}</div>`);
                    $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                }
            });
        }

        function uploadImage() {
            let fileInput = document.getElementById("image-upload");
            let file = fileInput.files[0];
            if (!file) return;

            let formData = new FormData();
            formData.append("image", file);

            let reader = new FileReader();
            reader.onload = function(e) {
                $("#user-image-container").html(`<img src="${e.target.result}" class="img-fluid mt-2">`);
            };
            reader.readAsDataURL(file);

            $.ajax({
                type: "POST",
                url: "/upload-image",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    $("#generated-image-container").html(`<h5 class='mt-3'>Generated Art</h5><img src="${response.image_url}" class="img-fluid mt-2">`);
                }
            });
        }

        function startSpeechRecognition() {
            let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "en-US";
            recognition.start();
            recognition.onresult = function(event) {
                document.getElementById("chat-input").value = event.results[0][0].transcript;
            };
        }
    </script>
</body>
</html>
